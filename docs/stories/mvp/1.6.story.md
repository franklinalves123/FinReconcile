# Story 1.6 — Paginação e Performance de Listagens

**Epic:** MVP — Fase 2: Qualidade e Dados
**Status:** Ready
**Estimativa:** 2 pontos (S)
**Agente responsável:** @dev (Dex)

---

## Objetivo

A tela de Relatórios limita a exibição a 100 linhas sem paginação real. Usuários com muitos lançamentos não conseguem ver o histórico completo. Implementar paginação client-side e extrair a lógica de `getCycleInfo` duplicada em Dashboard e Reports para um utilitário compartilhado.

---

## Escopo

### IN
- Implementar paginação na tabela analítica de Reports (50 itens por página)
- Remover o hardlimit de 100 linhas ou substituir por paginação
- Extrair `getCycleInfo()` para `lib/utils.ts` (atualmente duplicado em Dashboard.tsx e Reports.tsx)
- Adicionar indicador de total de registros filtrados ("Exibindo X de Y lançamentos")

### OUT
- Não implementar paginação server-side (escopo futuro — carregamento é client-side)
- Não implementar virtualização de lista (desnecessário para MVP)
- Não alterar outros componentes além dos citados

---

## Critérios de Aceite

- [ ] Tabela de relatórios exibe no máximo 50 itens por página
- [ ] Controles de paginação visíveis: página atual, total de páginas, botões Anterior/Próximo
- [ ] Texto "Exibindo X-Y de Z lançamentos" visível acima ou abaixo da tabela
- [ ] Paginação reseta para página 1 quando filtros são alterados
- [ ] `getCycleInfo` existe apenas em `lib/utils.ts` (nenhuma cópia em componentes)
- [ ] Dashboard e Reports importam `getCycleInfo` de `lib/utils.ts`
- [ ] Comportamento idêntico ao original após refatoração

---

## Notas Técnicas

### Extração de utilitário
```typescript
// lib/utils.ts
export interface CycleInfo {
  label: string;
  order: number;
}

export const getCycleInfo = (
  t: Transaction,
  invoiceDateMap: Record<string, string>
): CycleInfo => { ... }
```

### Paginação em Reports.tsx
```typescript
const [currentPage, setCurrentPage] = useState(1);
const ITEMS_PER_PAGE = 50;

const paginatedData = useMemo(() => {
  const start = (currentPage - 1) * ITEMS_PER_PAGE;
  return filteredData.slice(start, start + ITEMS_PER_PAGE);
}, [filteredData, currentPage]);

const totalPages = Math.ceil(filteredData.length / ITEMS_PER_PAGE);
```

**Lembrar:** resetar `currentPage` para 1 quando `filteredData` mudar (useEffect).

---

## Riscos

- **Baixo:** Paginação client-side é simples; risco principal é o reset correto ao filtrar

---

## Testes Sugeridos

1. Usuário com > 50 transações → paginação aparece com controles funcionais
2. Filtrar por ciclo com < 50 resultados → paginação some ou mostra "página 1 de 1"
3. Navegar para página 2, depois alterar filtro → volta para página 1
4. `getCycleInfo` retorna mesmos valores antes e depois da extração (smoke test)

---

## File List

| Arquivo | Ação |
|---------|------|
| `lib/utils.ts` | Criar (getCycleInfo + outras utils futuras) |
| `components/Dashboard.tsx` | Modificar (importar getCycleInfo de utils) |
| `components/Reports.tsx` | Modificar (importar getCycleInfo + implementar paginação) |

---

## Change Log

| Data | Agente | Ação |
|------|--------|------|
| 2026-02-20 | @architect (Brownfield) | Story criada |
